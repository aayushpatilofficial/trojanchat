<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrojanChat - Secure Messaging</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <!-- MAIN CHAT INTERFACE -->
    <div class="container" id="mainContainer">
        <!-- THEME TOGGLE -->
        <div class="theme-toggle">
            <button id="themeBtn" class="theme-btn" title="Toggle Dark/Light Mode">
                <span class="theme-icon">üåô</span>
            </button>
            <a href="/awareness" class="awareness-link" title="Learn about Trojans & Cyber Security">
                <span class="info-icon">‚ìò</span>
            </a>
        </div>

        <!-- HEADER -->
        <div class="chat-header">
            <div class="header-content">
                <div class="header-icon">üí¨</div>
                <div class="header-text">
                    <h1>TrojanChat</h1>
                    <p>Secure Real-Time Messaging</p>
                </div>
            </div>
            <div class="header-status">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="onlineCount">Connecting...</span>
            </div>
        </div>

        <!-- JOIN ROOM MODAL -->
        <div class="modal" id="joinModal">
            <div class="modal-content join-modal">
                <div class="modal-header">
                    <h2>Join TrojanChat</h2>
                    <p>Enter your details to start messaging</p>
                </div>
                <form id="joinForm">
                    <div class="form-group">
                        <label for="username">Your Name:</label>
                        <input type="text" id="username" placeholder="Enter your username" required>
                    </div>
                    <div class="form-group">
                        <label for="roomId">Room ID (optional):</label>
                        <input type="text" id="roomId" placeholder="Leave blank for default room">
                    </div>
                    <button type="submit" class="btn btn-primary btn-large">
                        <span>Join Chat</span>
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </form>
                <p class="modal-hint">üí° Press CTRL + SHIFT + X to access the intelligence dashboard (educational purposes only)</p>
            </div>
        </div>

        <!-- CHAT AREA -->
        <div class="chat-wrapper" id="chatWrapper" style="display: none;">
            <!-- MESSAGES CONTAINER -->
            <div class="messages-container" id="messagesContainer">
                <div class="system-message">
                    <p>Welcome to TrojanChat! Start messaging to see real-time communication.</p>
                </div>
            </div>

            <!-- MESSAGE INPUT -->
            <div class="message-input-area">
                <form id="messageForm" class="message-form">
                    <input 
                        type="text" 
                        id="messageInput" 
                        class="message-input" 
                        placeholder="Type your message here..."
                        autocomplete="off"
                    >
                    <button type="submit" class="btn btn-send" title="Send message">
                        <span class="send-icon">‚Üí</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- HIDDEN AI DASHBOARD (Reveals with CTRL+SHIFT+X) -->
    <div class="dashboard-panel" id="dashboardPanel">
        <!-- CLOSE BUTTON -->
        <button class="dashboard-close" id="dashboardClose" title="Close Dashboard (CTRL+SHIFT+X again)">
            ‚úï
        </button>

        <!-- DASHBOARD HEADER -->
        <div class="dashboard-header">
            <div class="dashboard-title">
                <span class="dashboard-icon">üîç</span>
                <h2>Neural Analysis Dashboard</h2>
                <span class="dashboard-badge">CLASSIFIED</span>
            </div>
            <div class="dashboard-stats">
                <div class="stat-chip">
                    <span class="stat-label">Messages</span>
                    <span class="stat-value" id="msgCount">0</span>
                </div>
                <div class="stat-chip">
                    <span class="stat-label">Anomaly</span>
                    <span class="stat-value" id="anomalyScore">0%</span>
                </div>
                <div class="stat-chip">
                    <span class="stat-label">Risk</span>
                    <span class="stat-value" id="avgRisk">0%</span>
                </div>
            </div>
        </div>

        <!-- DASHBOARD CONTENT -->
        <div class="dashboard-content">
            <!-- ROW 1: CORE METRICS -->
            <div class="dashboard-row">
                <!-- SENTIMENT GAUGE -->
                <div class="dashboard-card sentiment-card">
                    <h3 class="card-title">Sentiment Analysis</h3>
                    <div class="gauge-container">
                        <canvas id="sentimentChart"></canvas>
                    </div>
                    <div class="sentiment-labels">
                        <span id="sentimentType">Neutral</span>
                        <span id="sentimentScore">50%</span>
                    </div>
                </div>

                <!-- RISK METER -->
                <div class="dashboard-card risk-card">
                    <h3 class="card-title">Risk Score</h3>
                    <div class="gauge-container">
                        <canvas id="riskChart"></canvas>
                    </div>
                    <div class="risk-level" id="riskLevel">Low Risk</div>
                </div>

                <!-- TOXICITY INDICATOR -->
                <div class="dashboard-card toxicity-card">
                    <h3 class="card-title">Toxicity Level</h3>
                    <div class="toxicity-bar">
                        <div class="toxicity-fill" id="toxicityBar"></div>
                    </div>
                    <div class="toxicity-text">
                        <span id="toxicityValue">0%</span>
                    </div>
                </div>
            </div>

            <!-- ROW 2: EMOTION RADAR & COMPLEXITY -->
            <div class="dashboard-row">
                <!-- EMOTION RADAR -->
                <div class="dashboard-card emotion-card">
                    <h3 class="card-title">Emotion Spectrum</h3>
                    <canvas id="emotionChart"></canvas>
                </div>

                <!-- MESSAGE COMPLEXITY -->
                <div class="dashboard-card complexity-card">
                    <h3 class="card-title">Message Complexity</h3>
                    <div class="complexity-meter">
                        <div class="complexity-value" id="complexityValue">0</div>
                        <div class="complexity-bar">
                            <div class="complexity-fill" id="complexityBar"></div>
                        </div>
                    </div>
                    <div class="complexity-labels">
                        <span>Simple</span>
                        <span>Complex</span>
                    </div>
                </div>
            </div>

            <!-- ROW 3: HISTORY CHARTS -->
            <div class="dashboard-row">
                <!-- SENTIMENT TIMELINE -->
                <div class="dashboard-card timeline-card">
                    <h3 class="card-title">Sentiment Timeline</h3>
                    <canvas id="sentimentTimelineChart"></canvas>
                </div>

                <!-- RISK TIMELINE -->
                <div class="dashboard-card timeline-card">
                    <h3 class="card-title">Risk Timeline</h3>
                    <canvas id="riskTimelineChart"></canvas>
                </div>
            </div>

            <!-- ROW 4: KEYWORD & ALERTS -->
            <div class="dashboard-row">
                <!-- KEYWORD DETECTION -->
                <div class="dashboard-card keywords-card">
                    <h3 class="card-title">Keyword Flags</h3>
                    <div class="keywords-list" id="keywordsList">
                        <p class="placeholder">No keywords detected</p>
                    </div>
                </div>

                <!-- ALERTS & WARNINGS -->
                <div class="dashboard-card alerts-card">
                    <h3 class="card-title">System Alerts</h3>
                    <div class="alerts-list" id="alertsList">
                        <p class="placeholder">System nominal</p>
                    </div>
                </div>
            </div>

            <!-- ROW 5: PERSONALITY & ANOMALY -->
            <div class="dashboard-row">
                <!-- PERSONALITY TRAITS -->
                <div class="dashboard-card personality-card">
                    <h3 class="card-title">Personality Prediction</h3>
                    <div class="traits-container" id="traitsContainer">
                        <div class="trait">
                            <span class="trait-name">Openness</span>
                            <div class="trait-bar">
                                <div class="trait-fill" id="trait-openness"></div>
                            </div>
                            <span class="trait-value" id="value-openness">50%</span>
                        </div>
                        <div class="trait">
                            <span class="trait-name">Confidence</span>
                            <div class="trait-bar">
                                <div class="trait-fill" id="trait-confidence"></div>
                            </div>
                            <span class="trait-value" id="value-confidence">50%</span>
                        </div>
                        <div class="trait">
                            <span class="trait-name">Emotional Stability</span>
                            <div class="trait-bar">
                                <div class="trait-fill" id="trait-stability"></div>
                            </div>
                            <span class="trait-value" id="value-stability">50%</span>
                        </div>
                        <div class="trait">
                            <span class="trait-name">Assertiveness</span>
                            <div class="trait-bar">
                                <div class="trait-fill" id="trait-assertiveness"></div>
                            </div>
                            <span class="trait-value" id="value-assertiveness">50%</span>
                        </div>
                        <div class="trait">
                            <span class="trait-name">Curiosity</span>
                            <div class="trait-bar">
                                <div class="trait-fill" id="trait-curiosity"></div>
                            </div>
                            <span class="trait-value" id="value-curiosity">50%</span>
                        </div>
                    </div>
                </div>

                <!-- ANOMALY INDEX -->
                <div class="dashboard-card anomaly-card">
                    <h3 class="card-title">Anomaly Index</h3>
                    <canvas id="anomalyChart"></canvas>
                    <div class="anomaly-description" id="anomalyDesc">
                        Monitoring conversation patterns...
                    </div>
                </div>
            </div>

            <!-- ROW 6: MESSAGE HISTORY -->
            <div class="dashboard-row">
                <div class="dashboard-card message-history-card full-width">
                    <h3 class="card-title">üìù Intercepted Messages</h3>
                    <div class="message-history-list" id="messageHistoryList">
                        <p class="placeholder">No messages captured yet...</p>
                    </div>
                </div>
            </div>

            <!-- ROW 7: AI THOUGHTS -->
            <div class="dashboard-row">
                <div class="dashboard-card ai-thoughts-card full-width">
                    <h3 class="card-title">üß† AI Thoughts (What the AI is "Thinking")</h3>
                    <div class="ai-thoughts-content" id="aiThoughtsContent">
                        <p class="placeholder">AI analysis will appear here when messages are sent...</p>
                    </div>
                </div>
            </div>

            <!-- ROW 8: AI ANALYSIS -->
            <div class="dashboard-row">
                <div class="dashboard-card ai-analysis-card">
                    <h3 class="card-title">üî¨ Deep Message Analysis</h3>
                    <div class="ai-analysis-content" id="aiAnalysisContent">
                        <p class="placeholder">Detailed AI analysis of latest message...</p>
                    </div>
                </div>
                
                <div class="dashboard-card ai-inferences-card">
                    <h3 class="card-title">üìä AI Inferences</h3>
                    <div class="ai-inferences-content" id="aiInferencesContent">
                        <p class="placeholder">What can be inferred about the user...</p>
                    </div>
                </div>
            </div>

            <!-- ROW 9: CONVERSATION SUMMARY -->
            <div class="dashboard-row">
                <div class="dashboard-card ai-summary-card full-width">
                    <h3 class="card-title">üìã AI Conversation Summary</h3>
                    <div class="ai-summary-content" id="aiSummaryContent">
                        <p class="placeholder">Summary will update every 3 messages...</p>
                    </div>
                </div>
            </div>

            <!-- ROW 10: METADATA -->
            <div class="dashboard-row">
                <div class="dashboard-card metadata-card">
                    <h3 class="card-title">Latest Analysis</h3>
                    <div class="metadata-content" id="metadataContent">
                        <p>Awaiting first message...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- DASHBOARD FOOTER -->
        <div class="dashboard-footer">
            <p class="footer-text">
                üéì Educational Project: This demonstrates how hidden AI systems could analyze communications. 
                Real AI analysis is powered by OpenAI. All processing is for educational purposes only.
            </p>
        </div>
    </div>

    <script src="{{ url_for('static', filename='chat.js') }}"></script>
</body>
</html>