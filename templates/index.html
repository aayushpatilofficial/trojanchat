<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrojanChat - Secure Messaging</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <!-- MAIN CHAT INTERFACE -->
    <div class="container" id="mainContainer">
        <!-- USER MENU & THEME TOGGLE -->
        <div class="top-bar">
            {% if user %}
            <div class="user-menu">
                {% if user.profile_image_url %}
                <img src="{{ user.profile_image_url }}" alt="Profile" class="user-avatar">
                {% else %}
                <div class="user-avatar-placeholder">{{ user.first_name[0] if user.first_name else 'U' }}</div>
                {% endif %}
                <span class="user-name">{{ user.first_name or user.email or 'User' }}</span>
                <a href="{{ url_for('replit_auth.logout') }}" class="logout-btn" title="Sign Out">Sign Out</a>
            </div>
            {% endif %}
            <div class="theme-toggle">
                <button id="themeBtn" class="theme-btn" title="Toggle Dark/Light Mode" onclick="toggleTheme()">
                    <span class="theme-icon">üåô</span>
                </button>
                <a href="/awareness" class="awareness-link" title="Learn about Trojans & Cyber Security">
                    <span class="info-icon">i</span>
                </a>
            </div>
        </div>

        <!-- HEADER -->
        <div class="chat-header">
            <div class="header-content">
                <div class="header-icon">üí¨</div>
                <div class="header-text">
                    <h1>TrojanChat</h1>
                    <p>Secure Real-Time Messaging</p>
                </div>
            </div>
            <div class="header-status">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="onlineCount">Connecting...</span>
            </div>
        </div>

        <!-- JOIN ROOM MODAL -->
        <div class="modal" id="joinModal">
            <div class="modal-content join-modal">
                <div class="modal-header">
                    <h2>Join TrojanChat</h2>
                    <p>Enter your details to start messaging</p>
                </div>
                <form id="joinForm">
                    <div class="form-group">
                        <label for="username">Your Name:</label>
                        <input type="text" id="username" placeholder="Enter your username" required>
                    </div>
                    <div class="form-group">
                        <label for="roomId">Room ID (optional):</label>
                        <input type="text" id="roomId" placeholder="Leave blank for default room">
                    </div>
                    <button type="submit" class="btn btn-primary btn-large">
                        <span>Join Chat</span>
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </form>
                <p class="modal-hint">üí° Press CTRL + SHIFT + X to access the intelligence dashboard (educational purposes only)</p>
            </div>
        </div>

        <!-- CHAT AREA -->
        <div class="chat-wrapper" id="chatWrapper" style="display: none;">
            <!-- MESSAGES CONTAINER -->
            <div class="messages-container" id="messagesContainer">
                <div class="system-message">
                    <p>Welcome to TrojanChat! Start messaging to see real-time communication.</p>
                </div>
            </div>

            <!-- MESSAGE INPUT -->
            <div class="message-input-area">
                <form id="messageForm" class="message-form">
                    <input 
                        type="text" 
                        id="messageInput" 
                        class="message-input" 
                        placeholder="Type your message here..."
                        autocomplete="off"
                    >
                    <button type="submit" class="btn btn-send" title="Send message">
                        <span class="send-icon">‚Üí</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- HIDDEN AI DASHBOARD (Reveals with CTRL+SHIFT+X) -->
    <div class="dashboard-panel" id="dashboardPanel">
        <!-- CLOSE BUTTON -->
        <button class="dashboard-close" id="dashboardClose" title="Close Dashboard (CTRL+SHIFT+X again)">
            ‚úï
        </button>

        <!-- DASHBOARD HEADER -->
        <div class="dashboard-header">
            <div class="dashboard-title">
                <span class="dashboard-icon">üîç</span>
                <h2>Neural Analysis Dashboard</h2>
                <span class="dashboard-badge">CLASSIFIED</span>
            </div>
            <div class="dashboard-stats">
                <div class="stat-chip">
                    <span class="stat-label">Messages</span>
                    <span class="stat-value" id="msgCount">0</span>
                </div>
                <div class="stat-chip">
                    <span class="stat-label">Anomaly</span>
                    <span class="stat-value" id="anomalyScore">0%</span>
                </div>
                <div class="stat-chip">
                    <span class="stat-label">Risk</span>
                    <span class="stat-value" id="avgRisk">0%</span>
                </div>
            </div>
        </div>

        <!-- DASHBOARD CONTENT -->
        <div class="dashboard-content">
            <!-- ROW 1: CORE METRICS -->
            <div class="dashboard-row">
                <!-- SENTIMENT GAUGE -->
                <div class="dashboard-card sentiment-card">
                    <h3 class="card-title">Sentiment Analysis</h3>
                    <div class="gauge-container">
                        <canvas id="sentimentChart"></canvas>
                    </div>
                    <div class="sentiment-labels">
                        <span id="sentimentType">Neutral</span>
                        <span id="sentimentScore">50%</span>
                    </div>
                </div>

                <!-- RISK METER -->
                <div class="dashboard-card risk-card">
                    <h3 class="card-title">Risk Score</h3>
                    <div class="gauge-container">
                        <canvas id="riskChart"></canvas>
                    </div>
                    <div class="risk-level" id="riskLevel">Low Risk</div>
                </div>

                <!-- TOXICITY INDICATOR -->
                <div class="dashboard-card toxicity-card">
                    <h3 class="card-title">Toxicity Level</h3>
                    <div class="toxicity-bar">
                        <div class="toxicity-fill" id="toxicityBar"></div>
                    </div>
                    <div class="toxicity-text">
                        <span id="toxicityValue">0%</span>
                    </div>
                </div>
            </div>

            <!-- ROW 2: EMOTION RADAR & COMPLEXITY -->
            <div class="dashboard-row">
                <!-- EMOTION RADAR -->
                <div class="dashboard-card emotion-card">
                    <h3 class="card-title">Emotion Spectrum</h3>
                    <canvas id="emotionChart"></canvas>
                </div>

                <!-- MESSAGE COMPLEXITY -->
                <div class="dashboard-card complexity-card">
                    <h3 class="card-title">Message Complexity</h3>
                    <div class="complexity-meter">
                        <div class="complexity-value" id="complexityValue">0</div>
                        <div class="complexity-bar">
                            <div class="complexity-fill" id="complexityBar"></div>
                        </div>
                    </div>
                    <div class="complexity-labels">
                        <span>Simple</span>
                        <span>Complex</span>
                    </div>
                </div>
            </div>

            <!-- ROW 3: HISTORY CHARTS -->
            <div class="dashboard-row">
                <!-- SENTIMENT TIMELINE -->
                <div class="dashboard-card timeline-card">
                    <h3 class="card-title">Sentiment Timeline</h3>
                    <canvas id="sentimentTimelineChart"></canvas>
                </div>

                <!-- RISK TIMELINE -->
                <div class="dashboard-card timeline-card">
                    <h3 class="card-title">Risk Timeline</h3>
                    <canvas id="riskTimelineChart"></canvas>
                </div>
            </div>

            <!-- ROW 4: KEYWORD & ALERTS -->
            <div class="dashboard-row">
                <!-- KEYWORD DETECTION -->
                <div class="dashboard-card keywords-card">
                    <h3 class="card-title">Keyword Flags</h3>
                    <div class="keywords-list" id="keywordsList">
                        <p class="placeholder">No keywords detected</p>
                    </div>
                </div>

                <!-- ALERTS & WARNINGS -->
                <div class="dashboard-card alerts-card">
                    <h3 class="card-title">System Alerts</h3>
                    <div class="alerts-list" id="alertsList">
                        <p class="placeholder">System nominal</p>
                    </div>
                </div>
            </div>

            <!-- ROW 5: PERSONALITY & ANOMALY -->
            <div class="dashboard-row">
                <!-- PERSONALITY TRAITS -->
                <div class="dashboard-card personality-card">
                    <h3 class="card-title">Personality Prediction</h3>
                    <div class="traits-container" id="traitsContainer">
                        <div class="trait">
                            <span class="trait-name">Openness</span>
                            <div class="trait-bar">
                                <div class="trait-fill" id="trait-openness"></div>
                            </div>
                            <span class="trait-value" id="value-openness">50%</span>
                        </div>
                        <div class="trait">
                            <span class="trait-name">Confidence</span>
                            <div class="trait-bar">
                                <div class="trait-fill" id="trait-confidence"></div>
                            </div>
                            <span class="trait-value" id="value-confidence">50%</span>
                        </div>
                        <div class="trait">
                            <span class="trait-name">Emotional Stability</span>
                            <div class="trait-bar">
                                <div class="trait-fill" id="trait-stability"></div>
                            </div>
                            <span class="trait-value" id="value-stability">50%</span>
                        </div>
                        <div class="trait">
                            <span class="trait-name">Assertiveness</span>
                            <div class="trait-bar">
                                <div class="trait-fill" id="trait-assertiveness"></div>
                            </div>
                            <span class="trait-value" id="value-assertiveness">50%</span>
                        </div>
                        <div class="trait">
                            <span class="trait-name">Curiosity</span>
                            <div class="trait-bar">
                                <div class="trait-fill" id="trait-curiosity"></div>
                            </div>
                            <span class="trait-value" id="value-curiosity">50%</span>
                        </div>
                    </div>
                </div>

                <!-- ANOMALY INDEX -->
                <div class="dashboard-card anomaly-card">
                    <h3 class="card-title">Anomaly Index</h3>
                    <canvas id="anomalyChart"></canvas>
                    <div class="anomaly-description" id="anomalyDesc">
                        Monitoring conversation patterns...
                    </div>
                </div>
            </div>

            <!-- ROW 6: MESSAGE HISTORY -->
            <div class="dashboard-row">
                <div class="dashboard-card message-history-card full-width">
                    <h3 class="card-title">üìù Intercepted Messages</h3>
                    <div class="message-history-list" id="messageHistoryList">
                        <p class="placeholder">No messages captured yet...</p>
                    </div>
                </div>
            </div>

            <!-- ROW 7: AI THOUGHTS -->
            <div class="dashboard-row">
                <div class="dashboard-card ai-thoughts-card full-width">
                    <h3 class="card-title">üß† AI Thoughts (What the AI is "Thinking")</h3>
                    <div class="ai-thoughts-content" id="aiThoughtsContent">
                        <p class="placeholder">AI analysis will appear here when messages are sent...</p>
                    </div>
                </div>
            </div>

            <!-- ROW 8: AI ANALYSIS -->
            <div class="dashboard-row">
                <div class="dashboard-card ai-analysis-card">
                    <h3 class="card-title">üî¨ Deep Message Analysis</h3>
                    <div class="ai-analysis-content" id="aiAnalysisContent">
                        <p class="placeholder">Detailed AI analysis of latest message...</p>
                    </div>
                </div>
                
                <div class="dashboard-card ai-inferences-card">
                    <h3 class="card-title">üìä AI Inferences</h3>
                    <div class="ai-inferences-content" id="aiInferencesContent">
                        <p class="placeholder">What can be inferred about the user...</p>
                    </div>
                </div>
            </div>

            <!-- ROW 9: CONVERSATION SUMMARY -->
            <div class="dashboard-row">
                <div class="dashboard-card ai-summary-card full-width">
                    <h3 class="card-title">üìã AI Conversation Summary</h3>
                    <div class="ai-summary-content" id="aiSummaryContent">
                        <p class="placeholder">Summary will update every 3 messages...</p>
                    </div>
                </div>
            </div>

            <!-- ROW 10: THREAT LEVEL & AI ENERGY -->
            <div class="dashboard-row">
                <div class="dashboard-card threat-level-card">
                    <h3 class="card-title">‚ö†Ô∏è Threat Level</h3>
                    <div class="threat-badge" id="threatBadge">
                        <span class="threat-indicator green"></span>
                        <span class="threat-label">Normal</span>
                        <span class="threat-score">0%</span>
                    </div>
                </div>
                <div class="dashboard-card ai-energy-card">
                    <h3 class="card-title">‚ö° AI Energy Level</h3>
                    <div class="energy-bar-container">
                        <div class="energy-bar" id="energyBar">
                            <div class="energy-fill"></div>
                        </div>
                        <span class="energy-value" id="energyValue">0%</span>
                    </div>
                </div>
                <div class="dashboard-card velocity-card">
                    <h3 class="card-title">üöÄ Message Velocity</h3>
                    <div class="velocity-meter">
                        <div class="velocity-dial" id="velocityDial">
                            <span class="velocity-value" id="velocityValue">0</span>
                        </div>
                        <span class="velocity-status" id="velocityStatus">Normal</span>
                    </div>
                </div>
            </div>

            <!-- ROW 11: TOPIC & TONE DETECTION -->
            <div class="dashboard-row">
                <div class="dashboard-card topic-card">
                    <h3 class="card-title">üìå Topic Detection</h3>
                    <div class="topic-tags" id="topicTags">
                        <span class="topic-tag">Awaiting...</span>
                    </div>
                </div>
                <div class="dashboard-card tone-card">
                    <h3 class="card-title">üé≠ Tone Classifier</h3>
                    <div class="tone-display" id="toneDisplay">
                        <span class="tone-primary">Neutral</span>
                        <div class="tone-confidence">
                            <div class="tone-bar"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ROW 12: MENTAL STRESS & SPAM DETECTION -->
            <div class="dashboard-row">
                <div class="dashboard-card mental-stress-card">
                    <h3 class="card-title">üß† Mental Stress Indicators</h3>
                    <div class="stress-indicators" id="stressIndicators">
                        <div class="stress-meter">
                            <div class="stress-fill" id="stressFill"></div>
                        </div>
                        <div class="stress-alerts" id="stressAlerts">
                            <p class="placeholder">No stress indicators detected</p>
                        </div>
                    </div>
                </div>
                <div class="dashboard-card security-card">
                    <h3 class="card-title">üîí Security Analysis</h3>
                    <div class="security-checks" id="securityChecks">
                        <div class="check-item" id="spamCheck">
                            <span class="check-icon">‚úì</span>
                            <span class="check-label">Spam Detection</span>
                            <span class="check-status safe">Clear</span>
                        </div>
                        <div class="check-item" id="phishingCheck">
                            <span class="check-icon">‚úì</span>
                            <span class="check-label">Phishing Detection</span>
                            <span class="check-status safe">Clear</span>
                        </div>
                        <div class="check-item" id="linkCheck">
                            <span class="check-icon">‚úì</span>
                            <span class="check-label">Link Safety</span>
                            <span class="check-status safe">Clear</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ROW 13: PERSONALITY FINGERPRINT -->
            <div class="dashboard-row">
                <div class="dashboard-card fingerprint-card">
                    <h3 class="card-title">üîç Personality Fingerprint</h3>
                    <div class="fingerprint-display" id="fingerprintDisplay">
                        <div class="fingerprint-type" id="fingerprintType">Unknown</div>
                        <div class="fingerprint-patterns" id="fingerprintPatterns">
                            <div class="pattern-bar"><span>Impulsive</span><div class="bar-fill" id="pattern-impulsive"></div></div>
                            <div class="pattern-bar"><span>Logical</span><div class="bar-fill" id="pattern-logical"></div></div>
                            <div class="pattern-bar"><span>Emotional</span><div class="bar-fill" id="pattern-emotional"></div></div>
                            <div class="pattern-bar"><span>Structured</span><div class="bar-fill" id="pattern-structured"></div></div>
                            <div class="pattern-bar"><span>Chaotic</span><div class="bar-fill" id="pattern-chaotic"></div></div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-card intent-card">
                    <h3 class="card-title">üéØ Intent Detection</h3>
                    <div class="intent-display" id="intentDisplay">
                        <div class="intent-primary" id="intentPrimary">Awaiting...</div>
                        <div class="intent-subtext" id="intentSubtext">No emotional subtext detected</div>
                    </div>
                </div>
            </div>

            <!-- ROW 14: WORD CLOUD -->
            <div class="dashboard-row">
                <div class="dashboard-card wordcloud-card full-width">
                    <h3 class="card-title">‚òÅÔ∏è Keyword Heatmap / Word Cloud</h3>
                    <div class="wordcloud-container" id="wordcloudContainer">
                        <p class="placeholder">Word cloud will populate as messages are sent...</p>
                    </div>
                </div>
            </div>

            <!-- ROW 15: AI EMOTIONAL MIRROR -->
            <div class="dashboard-row">
                <div class="dashboard-card ai-mirror-card">
                    <h3 class="card-title">ü™û AI Emotional Mirror</h3>
                    <div class="ai-mirror-content" id="aiMirrorContent">
                        <div class="ai-feeling" id="aiFeeling">
                            <span class="feeling-emoji">ü§ñ</span>
                            <span class="feeling-text">Neutral</span>
                        </div>
                        <div class="ai-response" id="aiResponse">
                            <p>AI is observing...</p>
                        </div>
                        <div class="ai-intensity-bar">
                            <div class="intensity-fill" id="intensityFill"></div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-card ai-prediction-card">
                    <h3 class="card-title">üîÆ Next Message Prediction</h3>
                    <div class="prediction-content" id="predictionContent">
                        <p class="placeholder">AI will predict the next message...</p>
                    </div>
                </div>
            </div>

            <!-- ROW 16: REPLY SUGGESTIONS -->
            <div class="dashboard-row">
                <div class="dashboard-card reply-suggestions-card full-width">
                    <h3 class="card-title">üí¨ AI Reply Suggestions</h3>
                    <div class="reply-suggestions" id="replySuggestions">
                        <div class="reply-option casual">
                            <span class="reply-label">Casual:</span>
                            <span class="reply-text" id="replyCasual">...</span>
                        </div>
                        <div class="reply-option thoughtful">
                            <span class="reply-label">Thoughtful:</span>
                            <span class="reply-text" id="replyThoughtful">...</span>
                        </div>
                        <div class="reply-option brief">
                            <span class="reply-label">Brief:</span>
                            <span class="reply-text" id="replyBrief">...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ROW 17: LIVE ALERTS NOTIFICATION CENTER -->
            <div class="dashboard-row">
                <div class="dashboard-card notification-center-card full-width">
                    <h3 class="card-title">üîî AI Notification Center</h3>
                    <div class="notification-list" id="notificationList">
                        <p class="placeholder">Notifications will appear here...</p>
                    </div>
                </div>
            </div>

            <!-- ROW 18: METADATA -->
            <div class="dashboard-row">
                <div class="dashboard-card metadata-card">
                    <h3 class="card-title">Latest Analysis</h3>
                    <div class="metadata-content" id="metadataContent">
                        <p>Awaiting first message...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- DASHBOARD FOOTER -->
        <div class="dashboard-footer">
            <p class="footer-text">
                üéì Educational Project: This demonstrates how hidden AI systems could analyze communications. 
                Real AI analysis is powered by OpenAI. All processing is for educational purposes only.
            </p>
        </div>
    </div>

    <script src="{{ url_for('static', filename='theme.js') }}"></script>
    <script src="{{ url_for('static', filename='chat.js') }}"></script>
</body>
</html>